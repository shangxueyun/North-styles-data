<!doctype html>
<html>
<head>
<meta charset="UTF-8">
<meta id="viewport" name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, height=device-height" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="format-detection" content="telephone=no" />
<meta http-equiv="cache-control" content="no-cache"/>
<meta name="robots" content="all" />

<script src="webdoc/js/popimg.js" language="javascript"></script>
<link rel="stylesheet" type="text/css" href="webdoc/css/render.css">
<title>溟宗供应链</title>
</head>
<style>
	.red_err{
		color: red !important;
	}
	#loading_div{
		width: 100%;
		height: 100%;
		position: absolute;
		background: rgba(255, 255, 255, 0.8);
		top: 0;
		left: 0;
		z-index: 111;
	}
	.loading {
		top: 50%;
	}
	.loading:before {
		width: 2.5rem;
		height: 2.5rem;
		border: 2px solid #fff;
		border-top: 2px solid rgba(0,0,0,.1);
	}
</style>
<body>
<section class="header">
	<a class="logo" href="home.html"><img src="webdoc/img/logo.svg"></a>
	<a class="login" id='SignOut'><img src="webdoc/img/avatar.png"> 退出</a>
</section>

<section class="sideBar">
	<ul class="menu">
		<li><a href="home.html"><p class="basedInfo">基本信息</p></a></li>
		<li><a href="loan_info.html"><p class="loanInfo">贷款信息</p></a></li>
		<li class="on"><a href="bankaccount.html"><p class="bankAccount">资金监管专户</p></a></li>
		<li><a href="invoice.html"><p class="invoice">发票池信息</p></a></li>
		<li><a href="receivables.html"><p class="receivables">收款账户变更</p></a></li>
	</ul>
</section>

<section class="mainBar">
	<div class="mainBarTop">
		<div class="innerBox">
			<ul class="breadCrumbs">
				<li><a href="home.html">首页</a></li>
				<li><p>&nbsp;/&nbsp;</p></li>
				<li><a href="bankaccount.html">资金监管专户</a></li>
				<li><p>&nbsp;/&nbsp;</p></li>
				<li class="on"><p>申请开户</p></li>
			</ul>
		</div>
	</div>
	<div class="Box">
		<h2 class="heading01"><span>设置交易密码</span></h2>
		<div class="innerBox">
			<ul class="list_info wide01">
				<li>
					<span class="important">交易密码：</span>
					<p>
						<input autocomplete="off" class="input01" type="password" placeholder="请输入交易密码" id="passwordVlaue"  name="password" value="">
						<i class="red_err">长度为6-8位数字</i>
					</p>
				</li>
				<li>
					<span class="important">再次确认交易密码：</span>
					<p class="warn">
						<input autocomplete="off" class="input01 " type="password" id="repasswordVlaue" name="repassword" placeholder="请再次输入交易密码">
						<i class="red_err">两次密码输入不一致，请从新输入</i>
					</p>
				</li>
			</ul>
		</div>
	</div>
	<div class="submitbox">
		<ul class="list_info wide01">
			<li>
				<span>&nbsp;</span>
				<p>
					<a class="button btn_hollow_2" href="javascript:void(0);" onclick="history.back(-1);return false;">取消</a>
					<a style="margin-left: 1rem" class="button btn_block_2" id="OpenAccount">申请开户</a>
				</p>
			</li>
		</ul>
	</div>
</section>

<div id="loading_div" style="display: none;">
	<div class="loading"></div>
</div>

</body>
</html>
<script type="text/javascript" src="webdoc/js/jquery-3.3.1.min.js" ></script>
<script type="text/javascript" src="webdoc/js/home.js" ></script>
<script type="module">

import AJAX from './webdoc/js/api.js';

	$(function(){
		$("#OpenAccount").click(function(){
			if($("input[name='password']").val() == "")
			{
				alert("密码不能为空");return
			}
			$(loading_div).show()

			let data = JSON.parse(sessionStorage.data);data.bizContent.password = $("input[name='password']").val()
			data.bizContent.use = "SET"
			AJAX.AjaxResult('tradePassword','POST',data,'application/json').then(function(result){
				$(loading_div).hide()
				if(result.requestStatus=="SUCCESS"){
					$(loading_div).show()
					let data = JSON.parse(sessionStorage.data);data.bizContent.instCode = window.location.search.replace("?","")
					AJAX.AjaxResult('openFundAccount','POST',data,'application/json').then(function(result){
						$(loading_div).hide()
						if(result.requestStatus=="SUCCESS"){
							window.location.href="bankaccount_opening_done.html"
						}else{
							$(loading_div).hide()
							alert("请求失败")
						}
					}, err => {
						$(loading_div).hide()
						alert("请求失败")
					})
					.catch((error) => {
						//alert("服务器内部错误")
					})
			   	}else{
					$(loading_div).hide()
					alert("请求失败")
				}
			}, err => {
				$(loading_div).hide()
				alert("请求失败")
			})
			.catch((error) => {
				//alert("服务器内部错误")
			})	
		})

		$("i").hide();
		$("#passwordVlaue").blur((e)=>{
			blur(e,true)
		})
		$("#repasswordVlaue").blur((e)=>{
			blur(e,false)
		})
	
		function blur(e,type){
			let value = e.currentTarget.value,reg = /^\d{6,8}$/,
			Ele = $($(e.currentTarget.nextSibling.nextSibling)[0]);
			if(type)
			{
				if(!reg.test(value))
				{
					Ele.show()
					$("#passwordVlaue").focus()
				}
				else
					Ele.hide()
			}
			else
			{
				if($("#passwordVlaue").val() != $("#repasswordVlaue").val())
				{
					Ele.show()
					$("#repasswordVlaue")
				}
				else
					Ele.hide()
			}
		}
	})
</script>
